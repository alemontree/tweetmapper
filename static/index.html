<!DOCTYPE html>
<html>
  <head>
  <title>Map Test</title>
    <style type="text/css">
      html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
    </style>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB29i3sxB7GuKeeDCX3fVBbcQEJPquT5fs"></script>
    <script type="text/javascript" src="js/lib/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      var map;

      function initialize() {
        var mapOptions = {
          center: { lat: 40.5, lng: -95},
          zoom: 5
        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);


      }
      google.maps.event.addDomListener(window, 'load', initialize);

      var sio = io.connect('http://localhost:5000');
      sio.on('connect', function (data) {
        console.log("Connected to socket.io server");
        // For some reason we have to ping the server for broadcasts to work.
        sio.send('connected');
        sio.on('message', function (json) {
          console.log("loc =" + json);
          coordinates = JSON.parse(json);

          console.log("Broadcast incoming: " + json);
          console.log("lat= " + coordinates.lat);
          console.log("lng= " + coordinates.lng);

          lat = coordinates.lat;
          lng = coordinates.lng;

          var marker = new google.maps.Marker({
            position: new google.maps.LatLng(lat,lng),
            map: map,
            draggable: true,
            animation: google.maps.Animation.DROP,
            title:"Hello World!"

          //   TODO change title to location
          });

        });

      });

    </script>

  </head>
  <body>
      <div id="map-canvas"></div>
  </body>
</html>
